{"version":3,"file":"plugin.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from '@capacitor/core';\nconst CapOktaIdx = registerPlugin('CapOktaIdx', {\n    web: () => import('./web').then(m => new m.CapOktaIdxWeb()),\n});\nexport * from './definitions';\nexport { CapOktaIdx };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nimport { IdxStatus, OktaAuth } from '@okta/okta-auth-js';\nexport class CapOktaIdxWeb extends WebPlugin {\n    fetchTokens(data) {\n        // window.sessionStorage.clear();\n        // window.localStorage.clear();\n        return new Promise((resolve, reject) => {\n            const authClient = new OktaAuth({\n                issuer: data.issuer,\n                clientId: data.clientId,\n                redirectUri: data.redirectUri,\n                scopes: (data.scopes).split(' '),\n            });\n            (async () => {\n                var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n                // authClient.clearStorage();\n                // authClient.idx.clearTransactionMeta();\n                // authClient.tokenManager.clear();\n                // authClient.transactionManager.clear();\n                const authToken = await authClient.idx.startTransaction();\n                if (authToken.status === IdxStatus.SUCCESS) {\n                    const tokenResponse = {\n                        access_token: (_b = (_a = authToken.tokens) === null || _a === void 0 ? void 0 : _a.accessToken) === null || _b === void 0 ? void 0 : _b.accessToken,\n                        refresh_token: (_d = (_c = authToken.tokens) === null || _c === void 0 ? void 0 : _c.refreshToken) === null || _d === void 0 ? void 0 : _d.refreshToken,\n                        scope: (_f = (_e = authToken.tokens) === null || _e === void 0 ? void 0 : _e.accessToken) === null || _f === void 0 ? void 0 : _f.scopes.join(' '),\n                        id_token: (_h = (_g = authToken.tokens) === null || _g === void 0 ? void 0 : _g.idToken) === null || _h === void 0 ? void 0 : _h.idToken,\n                        token_type: (_k = (_j = authToken.tokens) === null || _j === void 0 ? void 0 : _j.accessToken) === null || _k === void 0 ? void 0 : _k.tokenType,\n                        expires_in: (_m = (_l = authToken.tokens) === null || _l === void 0 ? void 0 : _l.accessToken) === null || _m === void 0 ? void 0 : _m.expiresAt\n                    };\n                    resolve(tokenResponse);\n                }\n                else if (authToken.status === IdxStatus.PENDING) {\n                    await this.proceed(authToken, authClient, data, resolve, reject);\n                }\n                {\n                    reject();\n                }\n            })().catch(err => {\n                reject(err);\n            });\n        });\n    }\n    async proceed(authToken, authClient, data, resolve, reject) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w;\n        const username = data.username;\n        const password = data.password;\n        if (((_a = authToken === null || authToken === void 0 ? void 0 : authToken.messages) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n            reject({ message: authToken.messages[0].message });\n        }\n        else if (((_b = authToken === null || authToken === void 0 ? void 0 : authToken.nextStep) === null || _b === void 0 ? void 0 : _b.name) == 'identify' && ((_c = authToken === null || authToken === void 0 ? void 0 : authToken.nextStep) === null || _c === void 0 ? void 0 : _c.inputs) && ((_e = (_d = authToken === null || authToken === void 0 ? void 0 : authToken.nextStep) === null || _d === void 0 ? void 0 : _d.inputs) === null || _e === void 0 ? void 0 : _e.length) > 0) {\n            if (authToken.nextStep.inputs[0].name === 'username') {\n                authToken = await authClient.idx.proceed({ [authToken.nextStep.inputs[0].name]: username });\n            }\n        }\n        else if (((_f = authToken === null || authToken === void 0 ? void 0 : authToken.nextStep) === null || _f === void 0 ? void 0 : _f.name) == 'challenge-authenticator' && ((_g = authToken === null || authToken === void 0 ? void 0 : authToken.nextStep) === null || _g === void 0 ? void 0 : _g.inputs) && ((_j = (_h = authToken === null || authToken === void 0 ? void 0 : authToken.nextStep) === null || _h === void 0 ? void 0 : _h.inputs) === null || _j === void 0 ? void 0 : _j.length) > 0) {\n            if (authToken.nextStep.inputs[0].name === 'password') {\n                authToken = await authClient.idx.proceed({ [authToken.nextStep.inputs[0].name]: password });\n            }\n        }\n        if (authToken.status === IdxStatus.PENDING) {\n            await this.proceed(authToken, authClient, data, resolve, reject);\n        }\n        else if (authToken.status === IdxStatus.SUCCESS) {\n            const tokenResponse = {\n                access_token: (_l = (_k = authToken.tokens) === null || _k === void 0 ? void 0 : _k.accessToken) === null || _l === void 0 ? void 0 : _l.accessToken,\n                refresh_token: (_o = (_m = authToken.tokens) === null || _m === void 0 ? void 0 : _m.refreshToken) === null || _o === void 0 ? void 0 : _o.refreshToken,\n                scope: (_q = (_p = authToken.tokens) === null || _p === void 0 ? void 0 : _p.accessToken) === null || _q === void 0 ? void 0 : _q.scopes.join(' '),\n                id_token: (_s = (_r = authToken.tokens) === null || _r === void 0 ? void 0 : _r.idToken) === null || _s === void 0 ? void 0 : _s.idToken,\n                token_type: (_u = (_t = authToken.tokens) === null || _t === void 0 ? void 0 : _t.accessToken) === null || _u === void 0 ? void 0 : _u.tokenType,\n                expires_in: (_w = (_v = authToken.tokens) === null || _v === void 0 ? void 0 : _v.accessToken) === null || _w === void 0 ? void 0 : _w.expiresAt\n            };\n            resolve(tokenResponse);\n        }\n    }\n    refreshToken(data) {\n        return new Promise((resolve) => {\n            resolve(data);\n        });\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin","OktaAuth","IdxStatus"],"mappings":"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"}