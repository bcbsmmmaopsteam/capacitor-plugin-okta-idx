{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import { WebPlugin } from '@capacitor/core';\nimport type { IdxTransaction } from '@okta/okta-auth-js';\nimport { AuthenticatorKey , IdxStatus , OktaAuth } from '@okta/okta-auth-js';\n\nimport type { CapOktaIdxPlugin } from './definitions';\n\nexport class CapOktaIdxWeb extends WebPlugin implements CapOktaIdxPlugin {\n\n  private authClient: any;\n\n  fetchTokens(data: any): Promise<any> {\n\n    // window.sessionStorage.clear();\n    // window.localStorage.clear();\n\n    return new Promise((resolve, reject) => {\n      this.authClient = new OktaAuth({\n        issuer: data.issuer,\n        clientId: data.clientId,\n        redirectUri: data.redirectUri,\n        scopes: (data.scopes).split(' '),\n      });\n  \n      (async () => { \n        // authClient.clearStorage();\n        // authClient.idx.clearTransactionMeta();\n        // authClient.tokenManager.clear();\n        // authClient.transactionManager.clear();\n        const authToken: IdxTransaction = await this.authClient.idx.startTransaction();\n    \n        if (authToken.status !== IdxStatus.SUCCESS) {\n          await this.proceed(authToken, this.authClient, data, resolve, reject);\n        }else if (authToken.status === IdxStatus.SUCCESS) {\n          const tokenResponse = {\n            access_token: authToken.tokens?.accessToken?.accessToken,\n            refresh_token: authToken.tokens?.refreshToken?.refreshToken,\n            scope: authToken.tokens?.accessToken?.scopes.join(' '),\n            id_token: authToken.tokens?.idToken?.idToken,\n            token_type: authToken.tokens?.accessToken?.tokenType,\n            expires_in: authToken.tokens?.accessToken?.expiresAt\n          }\n          resolve(tokenResponse);\n        } else {\n          reject();\n        }\n      })().catch(err => {\n        reject(err);\n      });\n    })\n  }\n\n  async proceed(authToken: any, authClient: OktaAuth, data: any, resolve: any, reject: any): Promise<void> {\n    const username: string = data.username;\n    const password: string = data.password;\n    if (authToken?.messages?.length > 0) {\n      reject({message: authToken.messages[0]?.message, code: authToken.messages[0]?.i18n?.key});\n    }else if (authToken?.nextStep?.name == 'identify' && authToken?.nextStep?.inputs && authToken?.nextStep?.inputs?.length > 0) {\n      if (authToken.nextStep.inputs[0].name === 'username') {\n        authToken = await authClient.idx.proceed({[authToken.nextStep.inputs[0].name]: username, [authToken.nextStep.inputs[1].name]: data.rememberme});\n      }\n    } else if (authToken?.nextStep?.name == 'challenge-authenticator' && authToken?.nextStep?.inputs && authToken?.nextStep?.inputs?.length > 0) {\n      // let verificationCode = '1234';\n        if (authToken.nextStep.inputs[0].name === 'password') {\n          authToken = await authClient.idx.proceed({[authToken.nextStep.inputs[0].name]: password});\n        }else if (authToken.nextStep.inputs[0].name === 'verificationCode') {\n          resolve({remediation: authToken?.nextStep?.name });\n          return;\n        }\n    }\n    else if (authToken?.nextStep?.name == 'select-authenticator-authenticate' && authToken?.nextStep?.inputs && authToken?.nextStep?.inputs?.length > 0) {\n      const passwordOption = authToken?.nextStep?.inputs[0].options.find((res: any) => res.value === \"okta_password\")\n      if (passwordOption) {\n        authToken = await authClient.idx.proceed({[authToken.nextStep.inputs[0].name]: AuthenticatorKey.OKTA_PASSWORD});\n      }else {\n        resolve({\n          remediation: authToken?.nextStep?.name,\n          email: authToken?.neededToProceed[0]?.value[0]?.options[0]?.relatesTo?.profile?.email,\n          phoneNumber: authToken?.neededToProceed[0]?.value[0]?.options[1]?.relatesTo?.profile?.phoneNumber\n        })\n        return;\n      }\n      // else {\n      //   resolve({'remediation': authToken?.nextStep?.name});\n      // }\n      // if (authToken.nextStep.inputs[0].name === 'authenticator') {\n      //     authToken = await authClient.idx.proceed({[authToken.nextStep.inputs[0].name]: AuthenticatorKey.OKTA_EMAIL});\n      //   }\n    } else if (authToken?.nextStep?.name === 'authenticator-verification-data' && authToken?.nextStep?.inputs && authToken?.nextStep?.inputs?.length > 0) {\n        resolve({\n          remediation: authToken?.nextStep?.name,\n          email: authToken?.nextStep?.authenticator?.profile?.email\n        })\n        return;\n    }\n\n    if (authToken.status !== IdxStatus.SUCCESS) {\n        await this.proceed(authToken, authClient, data, resolve, reject);\n    }else if (authToken.status === IdxStatus.SUCCESS) {\n      const tokenResponse = {\n        access_token: authToken.tokens?.accessToken?.accessToken,\n        refresh_token: authToken.tokens?.refreshToken?.refreshToken,\n        scope: authToken.tokens?.accessToken?.scopes.join(' '),\n        id_token: authToken.tokens?.idToken?.idToken,\n        token_type: authToken.tokens?.accessToken?.tokenType,\n        expires_in: authToken.tokens?.accessToken?.expiresAt\n      }\n      resolve(tokenResponse);\n    }\n  }\n\n  refreshToken(data: any): Promise<any> {\n    return new Promise((resolve) => {\n      resolve(data);\n    })\n  }\n\n  selectAuthenticator(data: any): Promise<any> {\n    return new Promise((resolve, reject) => {\n      \n      (async () => { \n        let payload;\n        if (data?.remediation === 'authenticator-verification-data') {\n          payload = {methodType: data?.methodType}\n        }else {\n          payload = data?.type === 'email' ? {authenticator: AuthenticatorKey.OKTA_EMAIL, methodType: data?.methodType} : {authenticator: AuthenticatorKey.PHONE_NUMBER, methodType: data?.methodType}\n        }\n        const authToken = await this.authClient.idx.proceed(payload);\n        await this.proceed(authToken, this.authClient, data, resolve, reject);\n\n      })().catch(err => {\n        reject(err);\n      });\n    })\n  }  \n\n  verifyOtp(data: any): Promise<any> {\n    return new Promise((resolve, reject) => {\n      \n      (async () => { \n        const authToken = await this.authClient.idx.proceed({verificationCode: data?.otp});\n\n        await this.proceed(authToken, this.authClient, data, resolve, reject);\n\n      })().catch(err => {\n        reject(err);\n      });\n    })\n  }\n\n  resendOtp(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      (async () => { \n          const authToken = await this.authClient.idx.proceed({resend: true});\n          if (authToken?.messages?.length > 0) {\n            reject({message: authToken.messages[0].message, code : authToken.messages[0]?.i18n?.key});\n          }else {\n            resolve({\n              remediation: authToken?.nextStep?.name\n            })\n          }\n\n      })().catch(err => {\n        reject(err);\n      });\n    })\n  }\n\n  selectAlternateAuthenticator(data: any): Promise<any> {\n    return new Promise((resolve, reject) => {\n      \n      (async () => { \n        let authToken;\n        if (data?.type === 'email') {\n          authToken = await this.authClient.idx.proceed({authenticator: AuthenticatorKey.OKTA_EMAIL, methodType: data?.type});\n        }else if (data?.type === 'phone') {\n          authToken = await this.authClient.idx.proceed({authenticator: AuthenticatorKey.PHONE_NUMBER, methodType: data?.methodType});\n        }\n        await this.proceed(authToken, this.authClient, data, resolve, reject);\n\n      })().catch(err => {\n        reject(err);\n      });\n    })\n  }\n}\n"]}